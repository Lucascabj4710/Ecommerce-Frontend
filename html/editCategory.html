<!DOCTYPE html>
<html lang="es">
<head>
  <script src="../js/checkJwt.js" defer></script>
  <meta charset="UTF-8" />
  <title>Editar Categoría</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Requisitos del header unificado -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../css/normalize.css"/>
  <link rel="stylesheet" href="../css/style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --bg:#fef0f8; --card:#ffffff; --text:#3a2c35; --muted:#9d758e;
      --brand:#ec4899; --brand-2:#db2777; --ring:rgba(236,72,153,.18);
      --shadow:0 10px 30px rgba(236,72,153,.12); --radius:16px;
    }

    body{
      margin:0; min-height:100dvh; color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% -10%, #ffe3f1 0%, rgba(255,255,255,0) 60%),
        radial-gradient(900px 500px at 120% 110%, #ffd8ec 0%, rgba(255,255,255,0) 55%),
        #fff;
      display:flex; flex-direction:column;
    }

    .page-wrap{
      width:100%; max-width:980px;
      margin: clamp(24px,6vw,64px) auto 32px;
      padding: 0 20px;
    }

    .card-edit{
      background:var(--card); border-radius:var(--radius); box-shadow: var(--shadow);
      border:1px solid #ffe4f1; overflow:hidden; max-width:560px; margin:0 auto;
    }
    .card-head{
      padding: 20px 22px 10px; display:flex; align-items:center; gap:12px;
    }
    .badge{
      width:44px; height:44px; border-radius:12px; color:#fff; font-size:1.3rem;
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      display:grid; place-items:center; box-shadow:0 6px 16px rgba(236,72,153,.35);
    }
    .titles{ display:flex; flex-direction:column; }
    .titles h1{ margin:0; font-size:clamp(1.25rem,3vw,1.6rem); }
    .titles p{ margin:2px 0 0; color:var(--muted); }

    .card-body{ padding: 8px 22px 22px; display:grid; gap:14px; }

    .field{ display:grid; gap:8px; }
    .input-wrap{
      display:flex; align-items:center; gap:10px;
      border:1px solid #f9c2df; border-radius:12px; padding:10px 12px; background:#fff;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    .input-wrap:focus-within{ border-color:var(--brand); box-shadow:0 0 0 5px var(--ring); }
    .input-wrap i{ color:#b06b8b; font-size:1.05rem; }
    .input-wrap input{
      border:0; outline:0; width:100%; font-size:1rem; color:var(--text); background:transparent;
    }
    .help{ color:var(--muted); font-size:.9rem; }

    .actions{ display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-top:6px; }

    .btn{
      appearance:none; border:0; cursor:pointer; padding:10px 16px; border-radius:12px; font-weight:800;
      color:#fff; background: var(--brand);
      transition: transform .15s ease, filter .15s ease, box-shadow .15s ease;
      box-shadow: 0 10px 20px rgba(236,72,153,.22);
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ filter:brightness(.96); transform: translateY(-1px); }
    .btn:disabled{ opacity:.65; cursor:not-allowed; transform:none; box-shadow:none; }
    .btn-ghost{
      background:#e5e7eb; color:#374151; box-shadow:none; border:1px solid #e5e7eb;
    }
    .btn-ghost:hover{ background:#d1d5db; }

    .spinner{
      width:18px; height:18px; border-radius:50%;
      border:3px solid rgba(255,255,255,.55);
      border-top-color:#fff; animation: spin .8s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    @media (max-width:520px){
      .card-head{ padding:16px; }
      .card-body{ padding:8px 16px 16px; }
    }
  </style>
</head>
<body>

  <!-- ===== HEADER (idéntico al index) ===== -->
  <header>
    <div class="hero">
      <nav id="navbar" class="navegacion-principal contenedor">
        <ul class="menu">
          <li><a href="index.html">Inicio</a></li>

          <li class="submenu">
            <a href="getProducts.html">Productos <i class="fa-solid fa-caret-down"></i></a>
            <ul class="submenu-items">
              <!-- Categorías principales -->
              <li class="submenu-has-children">
                <a href="getProducts.html?q=anillo">Anillos <i class="fa-solid fa-chevron-right"></i></a>
                <ul class="subsubmenu-items">
                  <li><a href="getProducts.html?q=anillo&material=plata925">Plata 925</a></li>
                  <li><a href="getProducts.html?q=anillo&material=acero-quirurgico">Acero quirúrgico</a></li>
                  <li><a href="getProducts.html?q=anillo&material=acero-blanco">Acero blanco</a></li>
                  <li><a href="getProducts.html?q=anillo&material=adero-dorado">Adero dorado</a></li>
                </ul>
              </li>

              <li class="submenu-has-children">
                <a href="getProducts.html?q=pulsera">Pulseras <i class="fa-solid fa-chevron-right"></i></a>
                <ul class="subsubmenu-items">
                  <li><a href="getProducts.html?q=pulsera&material=plata925">Plata 925</a></li>
                  <li><a href="getProducts.html?q=pulsera&material=acero-quirurgico">Acero quirúrgico</a></li>
                  <li><a href="getProducts.html?q=pulsera&material=acero-blanco">Acero blanco</a></li>
                  <li><a href="getProducts.html?q=pulsera&material=adero-dorado">Adero dorado</a></li>
                </ul>
              </li>

              <li class="submenu-has-children">
                <a href="getProducts.html?q=collar">Collares <i class="fa-solid fa-chevron-right"></i></a>
                <ul class="subsubmenu-items">
                  <li><a href="getProducts.html?q=collar&material=plata925">Plata 925</a></li>
                  <li><a href="getProducts.html?q=collar&material=acero-quirurgico">Acero quirúrgico</a></li>
                  <li><a href="getProducts.html?q=collar&material=acero-blanco">Acero blanco</a></li>
                  <li><a href="getProducts.html?q=collar&material=adero-dorado">Adero dorado</a></li>
                </ul>
              </li>

              <!-- Otras secciones -->
              <li><a href="getProducts.html?q=relojes">Relojes</a></li>
              <li><a href="getProducts.html?q=carteras">Carteras</a></li>
            </ul>
          </li>

          <li><a href="contacto.html">Contacto</a></li>

          <li class="submenu">
            <a href="#">Cuenta <i class="fa-solid fa-caret-down"></i></a>
            <ul class="submenu-items">
              <li><a href="login.html">Iniciar sesión</a></li>
              <li><a href="register.html">Registrarme</a></li>
              <li><a href="admin.html">Panel de control ADMIN</a></li>
              <li><a href="dashboard.html">Mi perfil</a></li>
              <li><a href="logout.php">Cerrar sesión</a></li>
            </ul>
          </li>

          <li class="carrito">
            <a href="carrito.html" aria-label="Carrito">
              <img src="../imagenes/carrito2.png" alt="Carrito" width="32" height="32" />
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  <!-- ===== /HEADER ===== -->

  <!-- CONTENIDO -->
  <div class="page-wrap">
    <div class="card-edit" role="region" aria-labelledby="title-edit">
      <div class="card-head">
        <div class="badge"><i class="fa-solid fa-pen-to-square"></i></div>
        <div class="titles">
          <h1 id="title-edit">Editar categoría</h1>
          <p>Actualizá el nombre de una categoría existente.</p>
        </div>
      </div>

      <div class="card-body">
        <div class="field">
          <label for="editCategoryId">ID de la categoría</label>
          <div class="input-wrap">
            <i class="fa-solid fa-hashtag" aria-hidden="true"></i>
            <input type="number" id="editCategoryId" min="1" placeholder="Ej.: 12">
          </div>
          <small class="help">Ingresá el número de ID exacto.</small>
        </div>

        <div class="field">
          <label for="editCategoryName">Nuevo nombre</label>
          <div class="input-wrap">
            <i class="fa-regular fa-tag" aria-hidden="true"></i>
            <input type="text" id="editCategoryName" maxlength="60" placeholder="Ej.: Pulseras de acero">
          </div>
          <small class="help">Máx. 60 caracteres. Evitá símbolos innecesarios.</small>
        </div>

        <div class="actions">
          <a href="admin.html" class="btn btn-ghost">
            <i class="fa-solid fa-arrow-left"></i> Volver al panel
          </a>
          <button id="btnEdit" class="btn" type="button">
            <span id="btnIcon" class="" aria-hidden="true"></span>
            Guardar cambios
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS: Submenús por click en mobile (igual al index) -->
  <script>
    (function () {
      const mq = window.matchMedia('(max-width: 900px)');
      // Nivel 1 (Productos / Cuenta)
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu > a');
        if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          document.querySelectorAll('.submenu.open').forEach(x => { if (x !== li) x.classList.remove('open'); });
          li.classList.toggle('open');
        }
      });
      // Nivel 2 (sub-submenús)
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu-has-children > a');
        if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          li.classList.toggle('open');
          const panel = li.querySelector('.subsubmenu-items');
          if (panel) panel.style.display = (panel.style.display === 'block' ? 'none' : 'block');
        }
      });
    })();
  </script>

  <!-- JS: Lógica de edición con SweetAlert (tuya, intacta) -->
  <script>
    const $ = (q)=>document.querySelector(q);
    const idInput = $('#editCategoryId');
    const nameInput = $('#editCategoryName');
    const btn = $('#btnEdit');
    const btnIcon = $('#btnIcon');

    function sanitize(s){ return s.replace(/\s+/g,' ').trim(); }

    function validate(){
      const id = Number(idInput.value);
      const name = sanitize(nameInput.value);
      const ok = id > 0 && name.length > 0 && name.length <= 60;
      btn.disabled = !ok || sending;
      return { id, name, ok };
    }

    idInput.addEventListener('input', validate);
    nameInput.addEventListener('input', validate);
    nameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); btn.click(); } });

    let sending = false;

    async function editCategory(){
      const { id, name, ok } = validate();
      if(!ok) return;

      try{
        sending = true; btn.disabled = true;
        btnIcon.className = 'spinner';

        const res = await fetch(`http://localhost:8080/category/update/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ idCategory:id, name })
        });

        let payload = null;
        try{ payload = await res.json(); }catch{}

        if(res.ok){
          await Swal.fire({ icon:'success', title:'¡Categoría actualizada!', text: payload?.STATUS ?? 'Operación realizada con éxito', confirmButtonColor:'#ec4899' });
          nameInput.value = '';
          validate();
        }else{
          const msg = payload?.message || `HTTP ${res.status}`;
          await Swal.fire({ icon:'error', title:'No se pudo editar', text: msg, confirmButtonColor:'#ec4899' });
        }
      }catch(err){
        await Swal.fire({ icon:'error', title:'Error de conexión', text: err?.message || 'Intentá de nuevo.', confirmButtonColor:'#ec4899' });
      }finally{
        sending = false; btn.disabled = !validate().ok; btnIcon.className='';
      }
    }

    btn.addEventListener('click', editCategory);
    validate(); // estado inicial
  </script>

  <!-- (Opcional) Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
