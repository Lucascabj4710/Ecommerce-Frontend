<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Crear Categoría</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Requisitos del header (tu sitio) -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../css/normalize.css"/>
  <link rel="stylesheet" href="../css/style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --bg:#fef0f8;
      --card:#ffffff;
      --text:#3a2c35;
      --muted:#9d758e;
      --brand:#ec4899;      /* rosa principal (combina con tu sitio) */
      --brand-2:#db2777;    /* rosa oscuro */
      --ring:rgba(236,72,153,.18);
      --shadow:0 10px 30px rgba(236,72,153,.12);
      --radius:16px;
    }

    /* Fondo suave con gradiente */
    body{
      margin:0;
      min-height:100dvh;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% -10%, #ffe3f1 0%, rgba(255,255,255,0) 60%),
        radial-gradient(900px 500px at 120% 110%, #ffd8ec 0%, rgba(255,255,255,0) 55%),
        #fff;
      display:flex;
      flex-direction:column;
    }

    /* Espacio para el header con hero */
    .page-wrap{
      width:100%;
      max-width:980px;
      margin: clamp(24px, 6vw, 64px) auto 32px;
      padding: 0 20px;
    }

    /* Card centrado */
    .card-create{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid #ffe4f1;
      overflow:hidden;
    }

    .card-head{
      padding: 20px 22px 10px;
      display:flex; align-items:center; gap:12px;
    }
    .card-head .badge{
      width:44px; height:44px; border-radius:12px;
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      display:grid; place-items:center; color:#fff; font-size:1.3rem;
      box-shadow: 0 6px 16px rgba(236,72,153,.35);
    }
    .card-head .titles{
      display:flex; flex-direction:column;
    }
    .card-head h1{
      font-size: clamp(1.25rem, 3vw, 1.6rem);
      margin:0; line-height:1.2;
    }
    .card-head p{
      margin:2px 0 0; color:var(--muted); font-size:.95rem;
    }

    .card-body{
      padding: 8px 22px 22px;
      display:grid; gap:14px;
    }

    /* Campo con icono */
    .field{
      display:grid; gap:8px;
    }
    .input-wrap{
      display:flex; align-items:center; gap:10px;
      border:1px solid #f9c2df;
      border-radius:12px; padding:10px 12px;
      background:#fff; transition: box-shadow .15s ease, border-color .15s ease;
    }
    .input-wrap:focus-within{
      border-color: var(--brand);
      box-shadow: 0 0 0 5px var(--ring);
    }
    .input-wrap i{ color:#b06b8b; font-size:1.05rem; }
    .input-wrap input{
      border:0; outline:0; width:100%;
      font-size:1rem; color:var(--text); background:transparent;
    }
    .help{
      color:var(--muted); font-size:.9rem; display:flex; justify-content:space-between;
    }
    .help .count{ font-variant-numeric: tabular-nums; }

    /* Botones */
    .actions{
      display:flex; gap:10px; justify-content:flex-end; align-items:center; flex-wrap:wrap; margin-top:6px;
    }
    .btn{
      appearance:none; border:0; cursor:pointer;
      padding:10px 16px; border-radius:12px; font-weight:800;
      color:#fff; background: var(--brand);
      transition: transform .15s ease, filter .15s ease, box-shadow .15s ease;
      box-shadow: 0 10px 20px rgba(236,72,153,.22);
    }
    .btn:hover{ filter:brightness(.96); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn:disabled{ opacity:.65; cursor:not-allowed; transform:none; box-shadow:none; }

    .btn-ghost{
      background:#fff; color:var(--text);
      border:1px solid #f2cfe1; box-shadow:none;
    }
    .btn-ghost:hover{ background:#fff9fc; }

    .btn .spinner{
      width:18px; height:18px; border-radius:50%;
      border:3px solid rgba(255,255,255,.55);
      border-top-color:#fff; animation: spin .8s linear infinite;
      display:inline-block; vertical-align: -3px; margin-right:8px;
    }
    @keyframes spin { to{ transform: rotate(360deg); } }

    /* Footer fijo simple (volver) */
    .page-footer{
      margin: 10px auto 32px;
      max-width:980px; width:100%; padding:0 20px;
      display:flex; justify-content:flex-end;
    }

    /* Ajustes responsivos */
    @media (max-width: 520px){
      .card-head{ padding: 16px; }
      .card-body{ padding: 8px 16px 16px; }
    }
  </style>
</head>
<body>



  <!-- ===== CONTENIDO ===== -->
  <div class="page-wrap">
    <div class="card-create" role="region" aria-labelledby="title-create">
      <div class="card-head">
        <div class="badge"><i class="fa-solid fa-tags"></i></div>
        <div class="titles">
          <h1 id="title-create">Crear categoría</h1>
          <p>Agregá una nueva categoría al catálogo. Elegí un nombre claro y corto.</p>
        </div>
      </div>

      <div class="card-body">
        <div class="field">
          <label for="categoryName">Nombre de la categoría</label>
          <div class="input-wrap">
            <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
            <input id="categoryName"
                   type="text"
                   placeholder="Ej.: Anillos"
                   maxlength="60"
                   autocomplete="off"
                   aria-describedby="nameHelp nameCount">
          </div>
          <div class="help">
            <span id="nameHelp">Máx. 60 caracteres. Evitá símbolos innecesarios.</span>
            <span id="nameCount" class="count">0/60</span>
          </div>
        </div>

        <div class="actions">
          <a href="admin.html" class="btn btn-ghost">← Volver al panel</a>
          <button id="btnCreate" class="btn" type="button">
            Crear
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="page-footer">
    <!-- espacio para futuros enlaces secundarios si querés -->
  </footer>
  <!-- ===== /CONTENIDO ===== -->

  <!-- JS: abrir submenús por click en mobile -->
  <script>
    (function () {
      const mq = window.matchMedia('(max-width: 900px)');
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu > a'); if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          document.querySelectorAll('.submenu.open').forEach(x => { if (x !== li) x.classList.remove('open'); });
          li.classList.toggle('open');
        }
      });
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu-has-children > a'); if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          li.classList.toggle('open');
          const panel = li.querySelector('.subsubmenu-items');
          if (panel) panel.style.display = (panel.style.display === 'block' ? 'none' : 'block');
        }
      });
    })();
  </script>

  <!-- JS: lógica de creación con validación linda -->
  <script>
    const $ = (q)=>document.querySelector(q);
    const input = $('#categoryName');
    const btn = $('#btnCreate');
    const nameCount = $('#nameCount');

    // Estado de envío
    let sending = false;

    function updateCount(){
      nameCount.textContent = `${input.value.length}/60`;
    }
    updateCount();

    function sanitizeName(raw){
      // trim y colapsar espacios
      return raw.replace(/\s+/g,' ').trim();
    }

    function validate(){
      const name = sanitizeName(input.value);
      const valid = name.length > 0 && name.length <= 60;
      btn.disabled = !valid || sending;
      return { name, valid };
    }

    input.addEventListener('input', ()=>{
      updateCount();
      validate();
    });

    input.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        e.preventDefault();
        btn.click();
      }
    });

    async function createCategory(){
      const { name, valid } = validate();
      if(!valid) return;

      try{
        sending = true;
        btn.disabled = true;
        const prev = btn.innerHTML;
        btn.innerHTML = `<span class="spinner"></span>Creando...`;

        const res = await fetch("http://localhost:8080/category/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });

        let data = null;
        try{ data = await res.json(); }catch{ /* puede venir vacío */ }

        if(res.ok){
          await Swal.fire({
            icon: 'success',
            title: '¡Categoría creada!',
            text: data?.STATUS ?? 'Operación realizada con éxito',
            confirmButtonColor: '#ec4899'
          });
          input.value = '';
          updateCount();
          validate();
        }else{
          const msg = data?.message || `Error HTTP ${res.status}`;
          await Swal.fire({
            icon: 'error',
            title: 'No se pudo crear',
            text: msg,
            confirmButtonColor: '#ec4899'
          });
        }

      }catch(err){
        await Swal.fire({
          icon: 'error',
          title: 'Error de conexión',
          text: err?.message || 'Intentalo nuevamente.',
          confirmButtonColor: '#ec4899'
        });
      }finally{
        sending = false;
        btn.disabled = !validate().valid;
        btn.innerHTML = `Crear`;
      }
    }

    btn.addEventListener('click', createCategory);
    // Inicial
    validate();
  </script>

  <!-- (Opcional) Popper y Bootstrap JS por si los necesitás en esta página -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
