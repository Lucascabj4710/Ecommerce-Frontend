<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Productos - Paradiise</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../css/normalize.css" />
  <link rel="stylesheet" href="../css/style.css" />

  <style>
    :root{
      --bg1:#fff0f6; 
      --bg2:#fff8fc; 
      --card:#ffffff; 
      --text:#442a38;
      --muted:#8b5f73;
      --brand1:#ec4899;
      --brand2:#f472b6;
      --border:1px solid rgba(236,72,153,.25);
      --shadow:0 6px 20px rgba(236,72,153,.18);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      background: linear-gradient(165deg, var(--bg1) 0%, var(--bg2) 100%);
      margin: 0;
      color: var(--text);
    }

    main { padding: 40px 16px 60px; max-width: 1100px; margin: 0 auto; }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 800;
      font-size: clamp(1.4rem, 1.1rem + 1.2vw, 2rem);
      background: linear-gradient(90deg, var(--brand1), var(--brand2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 10px 40px rgba(236,72,153,.25);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      box-shadow: var(--shadow);
      border-radius: 14px;
      overflow: hidden;
    }

    th, td {
      padding: 14px;
      text-align: center;
      border-bottom: 1px solid rgba(236,72,153,.2);
    }

    th {
      background: linear-gradient(90deg, var(--brand1), var(--brand2));
      color: #fff;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: .5px;
    }

    tr:nth-child(odd){ background: rgba(255,182,193,.1); }
    tr:nth-child(even){ background: rgba(255,182,193,.15); }
    tr:hover{ background: rgba(236,72,153,.08); }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 6px 14px rgba(236,72,153,.25);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(236,72,153,.3);
      filter: brightness(1.05);
    }

    .status-btn {
      background: var(--brand1);
      margin-right: 6px;
    }

    .edit-btn {
      background: var(--brand2);
    }

    .enabled { color: #22c55e; font-weight: bold; }
    .disabled { color: #ef4444; font-weight: bold; }

    .message {
      text-align: center;
      margin-top: 20px;
      font-weight: 700;
    }

    .pagination {
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:18px;
    }

    .pgbtn {
      padding:8px 14px;
      border-radius:10px;
      border:1px solid rgba(236,72,153,.25);
      cursor:pointer;
      background:#fff;
      color:var(--brand1);
      box-shadow: var(--shadow);
      font-weight:600;
    }

    .pgbtn:hover{
      background:linear-gradient(90deg,var(--brand1),var(--brand2));
      color:#fff;
      box-shadow: 0 8px 20px rgba(236,72,153,.3);
    }

    .pgbtn:disabled {
      opacity:0.6;
      cursor:not-allowed;
    }
  </style>
</head>
<body>

  <!-- HEADER UNIFICADO -->
  <header class="hero">
    <nav id="navbar" class="navegacion-principal contenedor">
      <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>

        <li class="submenu">
          <a href="getProducts.html">Productos <i class="fa-solid fa-caret-down"></i></a>
          <ul class="submenu-items">
            <li class="submenu-has-children">
              <a href="getProducts.html?q=anillo">Anillos <i class="fa-solid fa-chevron-right"></i></a>
              <ul class="subsubmenu-items">
                <li><a href="getProducts.html?q=anillo&material=plata925">Plata 925</a></li>
                <li><a href="getProducts.html?q=anillo&material=acero-quirurgico">Acero quirúrgico</a></li>
                <li><a href="getProducts.html?q=anillo&material=acero-blanco">Acero blanco</a></li>
                <li><a href="getProducts.html?q=anillo&material=acero-dorado">Acero dorado</a></li>
              </ul>
            </li>
            <li class="submenu-has-children">
              <a href="getProducts.html?q=pulsera">Pulseras <i class="fa-solid fa-chevron-right"></i></a>
              <ul class="subsubmenu-items">
                <li><a href="getProducts.html?q=pulsera&material=plata925">Plata 925</a></li>
                <li><a href="getProducts.html?q=pulsera&material=acero-quirurgico">Acero quirúrgico</a></li>
                <li><a href="getProducts.html?q=pulsera&material=acero-blanco">Acero blanco</a></li>
                <li><a href="getProducts.html?q=pulsera&material=acero-dorado">Acero dorado</a></li>
              </ul>
            </li>
            <li class="submenu-has-children">
              <a href="getProducts.html?q=collar">Collares <i class="fa-solid fa-chevron-right"></i></a>
              <ul class="subsubmenu-items">
                <li><a href="getProducts.html?q=collar&material=plata925">Plata 925</a></li>
                <li><a href="getProducts.html?q=collar&material=acero-quirurgico">Acero quirúrgico</a></li>
                <li><a href="getProducts.html?q=collar&material=acero-blanco">Acero blanco</a></li>
                <li><a href="getProducts.html?q=collar&material=acero-dorado">Acero dorado</a></li>
              </ul>
            </li>
            <li><a href="getProducts.html?q=relojes">Relojes</a></li>
            <li><a href="getProducts.html?q=carteras">Carteras</a></li>
          </ul>
        </li>

        <li><a href="contacto.html">Contacto</a></li>

        <li class="submenu">
          <a href="#">Cuenta <i class="fa-solid fa-caret-down"></i></a>
          <ul class="submenu-items">
            <li><a href="login.html">Iniciar sesión</a></li>
            <li><a href="register.html">Registrarme</a></li>
            <li><a href="admin.html">Panel de control ADMIN</a></li>
            <li><a href="dashboard.html">Mi perfil</a></li>
            <li><a href="logout.php">Cerrar sesión</a></li>
          </ul>
        </li>

        <li class="carrito">
          <a href="carrito.html" aria-label="Ver carrito">
            <img src="../imagenes/carrito2.png" alt="Carrito" width="32">
          </a>
        </li>
      </ul>
    </nav>
  </header>
  <!-- FIN HEADER -->

  <main>
    <h1>Control de Productos</h1>

    <table>
      <thead>
        <tr>
          <th>ID</th><th>Nombre</th><th>Precio</th><th>Estado</th><th>Acción</th>
        </tr>
      </thead>
      <tbody id="productsBody">
        <tr><td colspan="5">Cargando productos...</td></tr>
      </tbody>
    </table>

    <div class="pagination">
      <button id="prev" class="pgbtn">Anterior</button>
      <button id="next" class="pgbtn">Siguiente</button>
    </div>

    <div id="message" class="message"></div>
  </main>

  <script>
    const API_BASE = "http://localhost:8080/products";
    const productsBody = document.getElementById("productsBody");
    const messageDiv = document.getElementById("message");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");

    let currentPage = 0;
    let pageSize = 10;
    let totalPages = 1;

    async function loadProducts(){
      try{
        const params = new URLSearchParams({ page: currentPage, size: pageSize });
        const res = await fetch(`${API_BASE}/getAll?${params.toString()}`);
        if(!res.ok) throw new Error(`Error de red: ${res.status}`);
        const data = await res.json();

        productsBody.innerHTML = "";

        if(!data.content || data.content.length===0){
          productsBody.innerHTML = "<tr><td colspan='5'>No hay productos</td></tr>";
          totalPages = data.totalPages ?? 1;
          prevBtn.disabled = true;
          nextBtn.disabled = true;
          return;
        }

        data.content.forEach(p=>{
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>$${p.price ?? 0}</td>
            <td class="${p.isEnabled==='ENABLED'?'enabled':'disabled'}">${p.isEnabled}</td>
            <td>
              <button class="status-btn" onclick="updateStatus(${p.id})">Cambiar estado</button>
              <button class="edit-btn" onclick="editarProducto('${encodeURIComponent(p.name)}')">Editar</button>
            </td>
          `;
          productsBody.appendChild(tr);
        });

        totalPages = data.totalPages ?? 1;
        prevBtn.disabled = data.first ?? (currentPage===0);
        nextBtn.disabled = data.last ?? (currentPage>=totalPages-1);
      }catch(e){
        productsBody.innerHTML = `<tr><td colspan="5">❌ ${e.message}</td></tr>`;
      }
    }

    async function updateStatus(id){
      try{
        const res = await fetch(`${API_BASE}/updateStatus/${id}`, { method: "POST" });
        if(!res.ok) throw new Error("No se pudo actualizar el estado");
        const data = await res.json();
        messageDiv.style.color = "green";
        messageDiv.textContent = "✅ Estado actualizado: " + JSON.stringify(data);
        await loadProducts();
      }catch(e){
        messageDiv.style.color = "red";
        messageDiv.textContent = "❌ " + e.message;
      }
    }

    function editarProducto(name){
      window.location.href = `updateProduct.html?name=${name}`;
    }

    prevBtn.addEventListener('click',()=>{ if(currentPage>0){ currentPage--; loadProducts(); } });
    nextBtn.addEventListener('click',()=>{ if(currentPage<totalPages-1){ currentPage++; loadProducts(); } });

    loadProducts();
  </script>
</body>
</html>
