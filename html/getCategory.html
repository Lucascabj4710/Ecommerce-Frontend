<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Categorías</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Requisitos del header -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../css/normalize.css"/>
  <link rel="stylesheet" href="../css/style.css"/>

  <style>
    :root{
      --card:#ffffff; --text:#333; --muted:#6b7280;
      --ring:rgba(0,0,0,.06); --radius:14px;
      --brand:#ec4899; --brand-2:#db2777; --border:#f7e1ef;
    }

    body{
      margin:0; background:#f4f4f9; color:var(--text);
      min-height:100dvh; display:flex; flex-direction:column;
      font-family: Arial, Helvetica, sans-serif;
    }

    .page-wrap{
      width:100%; max-width:980px;
      margin: clamp(24px,6vw,64px) auto 40px;
      padding: 0 20px;
    }

    .card-list{
      background:var(--card); border-radius:var(--radius);
      box-shadow: 0 10px 30px var(--ring);
      border: 1px solid #eef2f7; overflow:hidden;
    }

    .card-head{
      padding:18px 20px; display:flex; align-items:center; gap:12px; border-bottom:1px solid #f1f5f9;
    }
    .card-head .badge{
      width:42px; height:42px; border-radius:12px; color:#fff;
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      display:grid; place-items:center; font-size:1.1rem;
      box-shadow: 0 6px 16px rgba(236,72,153,.25);
    }
    .card-head h1{ margin:0; font-size: clamp(1.2rem, 3vw, 1.6rem); }
    .card-head p{ margin:2px 0 0; color:var(--muted); font-size:.95rem; }

    .card-body{ padding: 14px 20px 22px; }

    /* Toolbar: buscador + meta chip */
    .toolbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin: 6px 0 14px;
    }
    .searchbox{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:#fff;
      border:1px solid var(--border); box-shadow:0 1px 2px var(--ring);
      min-width:260px;
    }
    .searchbox i{ color: var(--brand-2); }
    .searchbox input{
      border:0; outline:0; background:transparent; font-size:1rem; width:240px; max-width:60vw;
    }
    .searchbox:focus-within{ box-shadow:0 0 0 4px rgba(236,72,153,.15); border-color:#f6c3e1; }

    .meta{
      background: #fff;
      color: var(--muted);
      border:1px solid var(--border);
      border-radius: 999px;
      padding: 8px 12px;
      box-shadow:0 1px 2px var(--ring);
      font-size:.95rem;
    }

    /* Tabla */
    table{
      width:100%; border-collapse: collapse; background:#fff;
    }
    thead th{
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      color:#fff; text-align:center;
      padding:12px; position:sticky; top:0; z-index:1;
      border-bottom: none;
    }
    tbody td{ padding:12px; text-align:center; border-bottom:1px solid #eef2f7; }
    tbody tr:hover{ background:#fff4fa; }

    .loader{
      display:none; text-align:center; margin: 6px 0 16px;
      color:var(--brand-2); font-weight:700;
    }

    @media (max-width:560px){
      .card-body{ padding: 12px 12px 18px; }
      thead th, tbody td{ padding:10px; }
      .searchbox input{ width: 160px; }
    }
  </style>
</head>
<body>



  <!-- CONTENIDO -->
  <div class="page-wrap">
    <div class="card-list" role="region" aria-labelledby="title-cats">
      <div class="card-head">
        <div class="badge"><i class="fa-solid fa-tags"></i></div>
        <div>
          <h1 id="title-cats">Lista de Categorías</h1>
          <p>Consulta rápida de las categorías disponibles en el sistema.</p>
        </div>
      </div>

      <div class="card-body">
        <div class="toolbar">
          <label class="searchbox" for="q">
            <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
            <input id="q" type="text" placeholder="Buscar por nombre o ID…"
                   aria-label="Buscar por nombre o ID de categoría">
          </label>
          <div id="meta" class="meta">—</div>
        </div>

        <div class="loader" id="loader">Cargando categorías…</div>

        <table id="categoryTable">
          <thead>
            <tr>
              <th style="width:160px">ID Categoría</th>
              <th>Nombre</th>
            </tr>
          </thead>
          <tbody><!-- dinámico --></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- JS: submenús por click en mobile -->
  <script>
    (function () {
      const mq = window.matchMedia('(max-width: 900px)');
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu > a'); if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          document.querySelectorAll('.submenu.open').forEach(x => { if (x !== li) x.classList.remove('open'); });
          li.classList.toggle('open');
        }
      });
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('.submenu-has-children > a'); if (!trigger) return;
        if (mq.matches) {
          e.preventDefault();
          const li = trigger.parentElement;
          li.classList.toggle('open');
          const panel = li.querySelector('.subsubmenu-items');
          if (panel) panel.style.display = (panel.style.display === 'block' ? 'none' : 'block');
        }
      });
    })();
  </script>

  <!-- JS: cargar + filtrar categorías -->
  <script>
    const $ = (q)=>document.querySelector(q);
    const tbody = $('#categoryTable tbody');
    const loader = $('#loader');
    const meta = $('#meta');
    const q = $('#q');

    let allCategories = [];
    let filtered = [];

    function renderTable(list){
      if(!Array.isArray(list) || list.length === 0){
        tbody.innerHTML = `<tr><td colspan="2">No hay categorías</td></tr>`;
        return;
      }
      tbody.innerHTML = '';
      list.forEach(cat=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cat.idCategory}</td>
          <td>${cat.name}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function applyFilter(){
      const s = q.value.trim().toLowerCase();
      if(!s){
        filtered = allCategories.slice();
      }else{
        filtered = allCategories.filter(c =>
          String(c.idCategory).includes(s) ||
          (c.name||'').toLowerCase().includes(s)
        );
      }
      renderTable(filtered);
      meta.textContent = `${filtered.length} resultado(s) • total ${allCategories.length}`;
    }

    function debounce(fn, ms=250){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
    }

    document.addEventListener("DOMContentLoaded", async () => {
      loader.style.display = "block";
      try {
        const response = await fetch("http://localhost:8080/category/get");
        if (!response.ok) throw new Error("Error en la petición");

        const data = await response.json();
        allCategories = Array.isArray(data) ? data : [];
        loader.style.display = "none";

        applyFilter(); // render inicial
        meta.textContent = `${filtered.length} resultado(s) • total ${allCategories.length}`;
      } catch (error) {
        loader.style.display = "none";
        tbody.innerHTML = "<tr><td colspan='2'>Error cargando categorías</td></tr>";
        meta.textContent = "—";
        console.error(error);
      }
    });

    q.addEventListener('input', debounce(applyFilter, 180));
  </script>
</body>
</html>
